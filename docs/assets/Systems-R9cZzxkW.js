var re=Object.defineProperty;var ne=(s,o,e)=>o in s?re(s,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[o]=e;var v=(s,o,e)=>(ne(s,typeof o!="symbol"?o+"":o,e),e);import"./modulepreload-polyfill-9p4a8sJU.js";import{V as h,e as ae,f as Z,B as se,g as V,b as E,h as B,i as oe,j as W,k as ce,l as he,m as de,n as le,o as ue,p as me,Q as R,W as pe,S as fe,C as ge,P as ve,A as ye,H as xe,D as we,O as Pe,q as Ce,R as Ne,a as J,M as Ve,d as Fe}from"./OrbitControls-gPwodfKu.js";import{D as De}from"./DragControls-6s1DdGGa.js";import{a as be}from"./simplex-noise-jK7XNhv8.js";class K{constructor(o,e,i,t){this.pos=new h(o,e,i),this.vel=new h,this.acc=new h,this.mass=t}applyForce(o){o.divideScalar(this.mass),this.acc.add(o),this.vel.add(this.acc),this.pos.add(this.vel),this.acc=new h(0,0,0)}follow(o){var e=Math.abs(Math.floor(this.pos.x)),i=Math.abs(Math.floor(this.pos.y)),t=Math.abs(Math.floor(this.pos.z)),r=e+i+t*50;console.log(r);var n=o[r];this.applyForce(n)}attract(o){let e=new h().subVectors(this.pos,o.pos),i=this.pos.distanceTo(o.pos);i<100&&(i=200),i>1e3&&(i=500);let r=10*(this.mass*o.mass)/(i*i);e.normalize(),e.multiplyScalar(r),o.applyForce(e)}}const a=class a extends ae{constructor(e,i){super();v(this,"advance",function(){const e=new B;return function(){this.targetObject.updateMatrixWorld(),e.copy(this.targetObject.matrixWorld),this.advanceWithTransform(e),this.updateUniforms()}}());v(this,"advanceGeometry",function(){return function(i,t){const r=this.currentEnd+1>=this.length?0:this.currentEnd+1;if(t?this.updateNodePositionsFromTransformMatrix(r,t):this.updateNodePositionsFromOrientationTangent(r,i.position,i.tangent),this.currentLength>=1&&(this.connectNodes(this.currentEnd,r),this.currentLength>=this.length)){const n=this.currentEnd+1>=this.length?0:this.currentEnd+1;this.disconnectNodes(n)}this.currentLength<this.length&&this.currentLength++,this.currentEnd++,this.currentEnd>=this.length&&(this.currentEnd=0),this.currentLength>=1&&(this.currentLength<this.length?this.geometry.setDrawRange(0,(this.currentLength-1)*this.FaceIndicesPerNode):this.geometry.setDrawRange(0,this.currentLength*this.FaceIndicesPerNode)),this.updateNodeID(this.currentEnd,this.currentNodeID),this.currentNodeID++}}());v(this,"updateHead",function(){const e=new B;return function(){this.currentEnd<0||(this.targetObject.updateMatrixWorld(),e.copy(this.targetObject.matrixWorld),this.updateNodePositionsFromTransformMatrix(this.currentEnd,e))}}());v(this,"updateNodePositionsFromOrientationTangent",function(){const e=new R,i=new h,t=[];for(let r=0;r<a.MaxHeadVertices;r++){const n=new h;t.push(n)}return function(n,c,m){const f=this.geometry.getAttribute("position");this.updateNodeCenter(n,c),i.copy(c),i.sub(a.LocalHeadOrigin),e.setFromUnitVectors(a.LocalOrientationTangent,m);for(let d=0;d<this.localHeadGeometry.length;d++){const p=t[d];p.copy(this.localHeadGeometry[d]),p.applyQuaternion(e),p.add(i)}for(let d=0;d<this.localHeadGeometry.length;d++){const p=(this.VerticesPerNode*n+d)*a.PositionComponentCount,l=t[d];f.array[p]=l.x,f.array[p+1]=l.y,f.array[p+2]=l.z}f.needsUpdate=!0}}());v(this,"updateNodePositionsFromTransformMatrix",function(){const e=new oe,i=new R,t=new h,r=new h,n=new h,c=new h,m=[];for(let d=0;d<a.MaxHeadVertices;d++){const p=new h;m.push(p)}function f(d,p){const l=p.elements;d.set(l[0],l[1],l[2],l[4],l[5],l[6],l[8],l[9],l[10])}return function(p,l){const y=this.geometry.getAttribute("position");t.set(0,0,0),t.applyMatrix4(l),this.updateNodeCenter(p,t);for(let u=0;u<this.localHeadGeometry.length;u++)m[u].copy(this.localHeadGeometry[u]);for(let u=0;u<this.localHeadGeometry.length;u++)m[u].applyMatrix4(l);if(this.lastNodeCenter&&this.orientToMovement&&(f(e,l),n.set(0,0,-1),n.applyMatrix3(e),c.copy(this.currentNodeCenter),c.sub(this.lastNodeCenter),c.normalize(),c.lengthSq()<=1e-4&&this.lastOrientationDir&&c.copy(this.lastOrientationDir),c.lengthSq()>1e-4)){this.lastOrientationDir||(this.lastOrientationDir=new h),i.setFromUnitVectors(n,c),r.copy(this.currentNodeCenter);for(let u=0;u<this.localHeadGeometry.length;u++){const x=m[u];x.sub(r),x.applyQuaternion(i),x.add(r)}}for(let u=0;u<this.localHeadGeometry.length;u++){const x=(this.VerticesPerNode*p+u)*a.PositionComponentCount,A=m[u];y.array[x]=A.x,y.array[x+1]=A.y,y.array[x+2]=A.z}y.needsUpdate=!0,y.updateRange.offset=p*this.VerticesPerNode*a.PositionComponentCount,y.updateRange.count=this.VerticesPerNode*a.PositionComponentCount}}());v(this,"connectNodes",function(){const e={attribute:null,offset:0,count:-1};return function(t,r){const n=this.geometry.getIndex();for(let c=0;c<this.localHeadGeometry.length-1;c++){const m=this.VerticesPerNode*t+c,f=this.VerticesPerNode*r+c,d=(t*this.FacesPerNode+c*a.FacesPerQuad)*a.IndicesPerFace;n.array[d]=m,n.array[d+1]=f,n.array[d+2]=m+1,n.array[d+3]=f,n.array[d+4]=f+1,n.array[d+5]=m+1}return n.needsUpdate=!0,n.updateRange.count=-1,e.attribute=n,e.offset=t*this.FacesPerNode*a.IndicesPerFace,e.count=this.FacesPerNode*a.IndicesPerFace,e}}());v(this,"disconnectNodes",function(){const e={attribute:null,offset:0,count:-1};return function(t){const r=this.geometry.getIndex();for(let n=0;n<this.localHeadGeometry.length-1;n++){const c=(t*this.FacesPerNode+n*a.FacesPerQuad)*a.IndicesPerFace;r.array[c]=0,r.array[c+1]=0,r.array[c+2]=0,r.array[c+3]=0,r.array[c+4]=0,r.array[c+5]=0}return r.needsUpdate=!0,r.updateRange.count=-1,e.attribute=r,e.offset=t*this.FacesPerNode*a.IndicesPerFace,e.count=this.FacesPerNode*a.IndicesPerFace,e}}());this.active=!1,this.orientToMovement=!1,i&&(this.orientToMovement=!0),this.scene=e,this.geometry=null,this.mesh=null,this.nodeCenters=null,this.lastNodeCenter=null,this.currentNodeCenter=null,this.lastOrientationDir=null,this.nodeIDs=null,this.currentLength=0,this.currentEnd=0,this.currentNodeID=0,this.advanceFrequency=60,this.advancePeriod=1/this.advanceFrequency,this.lastAdvanceTime=0,this.paused=!1,this.pauseAdvanceUpdateTimeDiff=0}setAdvanceFrequency(e){this.advanceFrequency=e,this.advancePeriod=1/this.advanceFrequency}initialize(e,i,t,r,n,c){this.deactivate(),this.destroyMesh(),this.length=i>0?i+1:0,this.dragTexture=t?1:0,this.targetObject=c,this.initializeLocalHeadGeometry(r,n),this.nodeIDs=[],this.nodeCenters=[];for(let m=0;m<this.length;m++)this.nodeIDs[m]=-1,this.nodeCenters[m]=new h;this.material=e,this.initializeGeometry(),this.initializeMesh(),this.material.uniforms.trailLength.value=0,this.material.uniforms.minID.value=0,this.material.uniforms.maxID.value=0,this.material.uniforms.dragTexture.value=this.dragTexture,this.material.uniforms.maxTrailLength.value=this.length,this.material.uniforms.verticesPerNode.value=this.VerticesPerNode,this.material.uniforms.textureTileFactor.value=new Z(1,1),this.reset()}initializeLocalHeadGeometry(e,i){if(this.localHeadGeometry=[],!i)halfWidth=e||1,halfWidth=halfWidth/2,this.localHeadGeometry.push(new h(-halfWidth,0,0)),this.localHeadGeometry.push(new h(halfWidth,0,0)),this.VerticesPerNode=2;else{this.VerticesPerNode=0;for(let t=0;t<i.length&&t<a.MaxHeadVertices;t++){const r=i[t];if(r&&r instanceof h){const n=new h;n.copy(r),this.localHeadGeometry.push(n),this.VerticesPerNode++}}}this.FacesPerNode=(this.VerticesPerNode-1)*2,this.FaceIndicesPerNode=this.FacesPerNode*3}initializeGeometry(){this.vertexCount=this.length*this.VerticesPerNode,this.faceCount=this.length*this.FacesPerNode;const e=new se,i=new Float32Array(this.vertexCount),t=new Float32Array(this.vertexCount*this.VerticesPerNode),r=new Float32Array(this.vertexCount*a.PositionComponentCount),n=new Float32Array(this.vertexCount*a.PositionComponentCount),c=new Float32Array(this.vertexCount*a.UVComponentCount),m=new Uint32Array(this.faceCount*a.IndicesPerFace),f=new V(i,1);f.dynamic=!0,e.setAttribute("nodeID",f);const d=new V(t,1);d.dynamic=!0,e.setAttribute("nodeVertexID",d);const p=new V(n,a.PositionComponentCount);p.dynamic=!0,e.setAttribute("nodeCenter",p);const l=new V(r,a.PositionComponentCount);l.dynamic=!0,e.setAttribute("position",l);const y=new V(c,a.UVComponentCount);y.dynamic=!0,e.setAttribute("uv",y);const u=new V(m,1);u.dynamic=!0,e.setIndex(u),this.geometry=e}zeroVertices(){const e=this.geometry.getAttribute("position");for(let i=0;i<this.vertexCount;i++){const t=i*3;e.array[t]=0,e.array[t+1]=0,e.array[t+2]=0}e.needsUpdate=!0,e.updateRange.count=-1}zeroIndices(){const e=this.geometry.getIndex();for(let i=0;i<this.faceCount;i++){const t=i*3;e.array[t]=0,e.array[t+1]=0,e.array[t+2]=0}e.needsUpdate=!0,e.updateRange.count=-1}formInitialFaces(){this.zeroIndices();const e=this.geometry.getIndex();for(let i=0;i<this.length-1;i++)this.connectNodes(i,i+1);e.needsUpdate=!0,e.updateRange.count=-1}initializeMesh(){this.mesh=new E(this.geometry,this.material),this.mesh.dynamic=!0,this.mesh.matrixAutoUpdate=!1}destroyMesh(){this.mesh&&(this.scene.remove(this.mesh),this.mesh=null)}reset(){this.currentLength=0,this.currentEnd=-1,this.lastNodeCenter=null,this.currentNodeCenter=null,this.lastOrientationDir=null,this.currentNodeID=0,this.formInitialFaces(),this.zeroVertices(),this.geometry.setDrawRange(0,0)}updateUniforms(){this.currentLength<this.length?this.material.uniforms.minID.value=0:this.material.uniforms.minID.value=this.currentNodeID-this.length,this.material.uniforms.maxID.value=this.currentNodeID,this.material.uniforms.trailLength.value=this.currentLength,this.material.uniforms.maxTrailLength.value=this.length,this.material.uniforms.verticesPerNode.value=this.VerticesPerNode}advanceWithPositionAndOrientation(e,i){this.advanceGeometry({position:e,tangent:i},null)}advanceWithTransform(e){this.advanceGeometry(null,e)}currentTime(){return performance.now()/1e3}pause(){this.paused||(this.paused=!0,this.pauseAdvanceUpdateTimeDiff=this.currentTime()-this.lastAdvanceTime)}resume(){this.paused&&(this.paused=!1,this.lastAdvanceTime=this.currentTime()-this.pauseAdvanceUpdateTimeDiff)}update(){if(!this.paused){const e=this.currentTime();this.lastAdvanceTime||(this.lastAdvanceTime=e),e-this.lastAdvanceTime>this.advancePeriod?(this.advance(),this.lastAdvanceTime=e):this.updateHead()}}updateNodeID(e,i){this.nodeIDs[e]=i;const t=this.geometry.getAttribute("nodeID"),r=this.geometry.getAttribute("nodeVertexID");for(let n=0;n<this.VerticesPerNode;n++){const c=e*this.VerticesPerNode+n;t.array[c]=i,r.array[c]=n}t.needsUpdate=!0,r.needsUpdate=!0,t.updateRange.offset=e*this.VerticesPerNode,t.updateRange.count=this.VerticesPerNode,r.updateRange.offset=e*this.VerticesPerNode,r.updateRange.count=this.VerticesPerNode}updateNodeCenter(e,i){this.lastNodeCenter=this.currentNodeCenter,this.currentNodeCenter=this.nodeCenters[e],this.currentNodeCenter.copy(i);const t=this.geometry.getAttribute("nodeCenter");for(let r=0;r<this.VerticesPerNode;r++){const n=(e*this.VerticesPerNode+r)*3;t.array[n]=i.x,t.array[n+1]=i.y,t.array[n+2]=i.z}t.needsUpdate=!0,t.updateRange.offset=e*this.VerticesPerNode*a.PositionComponentCount,t.updateRange.count=this.VerticesPerNode*a.PositionComponentCount}deactivate(){this.isActive&&(this.scene.remove(this.mesh),this.isActive=!1)}activate(){this.isActive||(this.scene.add(this.mesh),this.isActive=!0)}static createMaterial(e,i,t){return t=t||{},t.trailLength={type:"f",value:null},t.verticesPerNode={type:"f",value:null},t.minID={type:"f",value:null},t.maxID={type:"f",value:null},t.dragTexture={type:"f",value:null},t.maxTrailLength={type:"f",value:null},t.textureTileFactor={type:"v2",value:null},t.headColor={type:"v4",value:new W},t.tailColor={type:"v4",value:new W},e=e||a.Shader.BaseVertexShader,i=i||a.Shader.BaseFragmentShader,new ce({uniforms:t,vertexShader:e,fragmentShader:i,transparent:!0,alphaTest:.5,blending:he,blendSrc:de,blendDst:le,blendEquation:ue,depthTest:!0,depthWrite:!1,side:me})}static createBaseMaterial(e){return a.createMaterial(a.Shader.BaseVertexShader,a.Shader.BaseFragmentShader,e)}static createTexturedMaterial(e){return e={},e.trailTexture={type:"t",value:null},a.createMaterial(a.Shader.TexturedVertexShader,a.Shader.TexturedFragmentShader,e)}static get MaxHeadVertices(){return 128}static get LocalOrientationTangent(){return _LocalOrientationTangent}static get LocalHeadOrigin(){return _LocalHeadOrigin}static get PositionComponentCount(){return 3}static get UVComponentCount(){return 2}static get IndicesPerFace(){return 3}static get FacesPerQuad(){return 2}};v(a,"_LocalOrientationTangent",new h(1,0,0)),v(a,"_LocalHeadOrigin",new h(0,0,0)),v(a,"Shader",{get BaseVertexVars(){return["attribute float nodeID;","attribute float nodeVertexID;","attribute vec3 nodeCenter;","uniform float minID;","uniform float maxID;","uniform float trailLength;","uniform float maxTrailLength;","uniform float verticesPerNode;","uniform vec2 textureTileFactor;","uniform vec4 headColor;","uniform vec4 tailColor;","varying vec4 vColor;"].join(`
`)},get TexturedVertexVars(){return[this.BaseVertexVars,"varying vec2 vUV;","uniform float dragTexture;"].join(`
`)},BaseFragmentVars:["varying vec4 vColor;","uniform sampler2D trailTexture;"].join(`
`),get TexturedFragmentVars(){return[this.BaseFragmentVars,"varying vec2 vUV;"].join(`
`)},get VertexShaderCore(){return["float fraction = (maxID - nodeID) / (maxID - minID);","vColor = (1.0 - fraction) * headColor + fraction * tailColor;","vec4 realPosition = vec4((1.0 - fraction) * position.xyz + fraction * nodeCenter.xyz, 1.0); "].join(`
`)},get BaseVertexShader(){return[this.BaseVertexVars,"void main() { ",this.VertexShaderCore,"gl_Position = projectionMatrix * viewMatrix * realPosition;","}"].join(`
`)},get BaseFragmentShader(){return[this.BaseFragmentVars,"void main() { ","gl_FragColor = vColor;","}"].join(`
`)},get TexturedVertexShader(){return[this.TexturedVertexVars,"void main() { ",this.VertexShaderCore,"float s = 0.0;","float t = 0.0;","if (dragTexture == 1.0) { ","   s = fraction *  textureTileFactor.s; ","     t = (nodeVertexID / verticesPerNode) * textureTileFactor.t;","} else { ","    s = nodeID / maxTrailLength * textureTileFactor.s;","     t = (nodeVertexID / verticesPerNode) * textureTileFactor.t;","}","vUV = vec2(s, t); ","gl_Position = projectionMatrix * viewMatrix * realPosition;","}"].join(`
`)},get TexturedFragmentShader(){return[this.TexturedFragmentVars,"void main() { ","vec4 textureColor = texture2D(trailTexture, vUV);","gl_FragColor = vColor * textureColor;","}"].join(`
`)}});let T=a,j=[];const Ie=document.querySelector("#app"),C=new pe({antialias:!0});C.setPixelRatio(window.devicePixelRatio);C.setSize(window.innerWidth,window.innerHeight);Ie.appendChild(C.domElement);document.body.appendChild(C.domElement);const N=new fe;N.background=new ge("#5BB2F0");const P=new ve(35,window.innerWidth/window.innerHeight,1,1e3);P.position.set(20,50,200);const Me=new ye("white",.2),Te=new xe("#ffffff","#ff00ff",.8),Ae=new we("white",.8);Ae.position.set(-1,1,1);N.add(Me,Te);const g=new Pe(P,C.domElement);g.enableDamping=!0;g.dampingFactor=.05;g.screenSpacePanning=!1;g.enableRotate=!0;g.rotateSpeed=.5;g.enableZoom=!0;g.zoomSpeed=.5;g.minDistance=100;g.maxDistance=1e4;g.target=new h(0,0,0);const $=new De(j,P,C.domElement);$.addEventListener("dragstart",function(){g.enabled=!1});$.addEventListener("dragend",function(){g.enabled=!0});const Le=()=>{P.aspect=window.innerWidth/window.innerHeight,P.updateProjectionMatrix(),C.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",Le);const L=new Z,D=new h,q=new h,U=new Ce,Q=new Ne;let b=[];window.addEventListener("keydown",function(s){L.x=s.clientX/window.innerWidth*2-1,L.y=-(s.clientY/window.innerHeight)*2+1,q.copy(P.position).normalize(),U.setFromNormalAndCoplanarPoint(q,N.position),Q.setFromCamera(L,P),Q.ray.intersectPlane(U,D);const o=new E(new J(2,30,30),new Ve({color:16103345,metalness:0,roughness:0}));j.push(o),N.add(o);let e=new K(D.x,D.y,D.z,15);b.push(e),o.position.copy(D)});let _;var ee=10,te=10,G=10,F=1;_=new Array(G*te*ee);var k=0;for(var H=0;H<ee;H+=F){for(var X=0,S=0;S<te;S+=F){for(var Y=0,O=0;O<G;O+=F){var He=O+S+H*G,Se=be(),z=Se(k,X,Y)+1;let s=new h(Math.cos(z*Math.PI),Math.sin(z*Math.PI),Math.cos(z*Math.PI));_[He]=s,Y+=F}X+=F}k+=F}const Oe=new Fe({color:"#1da2d8"}),ze=new J(1,64,64);let I=[],w=[],M=[];for(let s=0;s<15;s++){w[s]=new K(Math.random()*50,Math.random()*50,Math.random()*50,Math.random()*5),I[s]=new E(ze,Oe),I[s].position.set(w[s].pos.x,w[s].pos.y,w[s].pos.z),N.add(I[s]);const o=[];o.push(new h(-1,0,0),new h(0,0,0),new h(1,0,0)),M[s]=new T(N,!1),M[s].setAdvanceFrequency(100);const e=T.createBaseMaterial();M[s].initialize(e,150,!1,0,o,I[s]),e.uniforms.headColor.value.set(.1,.4,.9,1),e.uniforms.tailColor.value.set(.2,.2,.9,.5),M[s].activate()}const ie=()=>{if(requestAnimationFrame(ie),b.length>0)for(let s=0;s<w.length;s++){for(let o=0;o<b.length;o++)b[o].attract(w[s]),b[o].pos=j[o].position;I[s].position.set(w[s].pos.x,w[s].pos.y,w[s].pos.z),M[s].update()}C.render(N,P)};ie();
